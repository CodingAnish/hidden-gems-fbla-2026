{% extends "base.html" %}

{% block content %}
<style>
  .page-hero {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    padding: 40px 20px;
    text-align: center;
  }

  .page-title {
    font-size: 2.2rem;
    margin: 0 0 10px 0;
    color: white;
  }

  .page-subtitle {
    font-size: 1rem;
    margin: 0;
    color: rgba(255, 255, 255, 0.9);
  }

  .form-container {
    max-width: 500px;
    margin: 40px auto;
    padding: 30px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
  }

  .form-group input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    font-size: 1rem;
    box-sizing: border-box;
    transition: border-color 0.3s;
  }

  .form-group input:focus {
    outline: none;
    border-color: #f59e0b;
  }

  .password-requirements {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
    font-size: 0.9rem;
    color: #78350f;
  }

  .requirements-list {
    margin: 10px 0 0 0;
    padding-left: 20px;
    list-style: none;
  }

  .requirements-list li {
    margin: 5px 0;
    position: relative;
    padding-left: 20px;
  }

  .requirements-list li:before {
    content: "✗";
    position: absolute;
    left: 0;
    color: #dc2626;
    font-weight: bold;
    font-size: 1.1rem;
  }

  .requirements-list li.met:before {
    content: "✓";
    color: #059669;
  }

  .password-strength {
    margin-top: 12px;
    padding: 10px;
    border-radius: 4px;
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
    display: none;
  }

  .password-strength.weak {
    display: block;
    background: #fee2e2;
    color: #991b1b;
  }

  .password-strength.medium {
    display: block;
    background: #fef3c7;
    color: #92400e;
  }

  .password-strength.strong {
    display: block;
    background: #dcfce7;
    color: #166534;
  }

  .btn {
    width: 100%;
    padding: 12px;
    background: #f59e0b;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s;
  }

  .btn:hover {
    background: #d97706;
  }

  .info-box {
    background: #dbeafe;
    border-left: 4px solid #0284c7;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
    color: #0c4a6e;
    font-size: 0.95rem;
  }

  .info-box p {
    margin: 0;
  }

  .back-link {
    text-align: center;
    margin-top: 15px;
  }

  .back-link a {
    color: #10B981;
    text-decoration: none;
    font-weight: 500;
  }

  .back-link a:hover {
    text-decoration: underline;
  }
</style>

<div class="page-hero">
  <h1 class="page-title">Reset Password</h1>
  <p class="page-subtitle">Set a new password for your Hidden Gems account</p>
</div>

<div class="form-container">
  <div class="info-box">
    <p><strong>Account:</strong> {{ email }}</p>
  </div>

  <form method="POST" onsubmit="return validatePasswordReset()">
    <div class="password-requirements">
      <strong>Password must have:</strong>
      <ul class="requirements-list">
        <li id="length-req">At least 8 characters</li>
        <li id="uppercase-req">One uppercase letter (A-Z)</li>
        <li id="number-req">One number (0-9)</li>
        <li id="special-req">One special character (!@#$%^&*)</li>
      </ul>
      <div class="password-strength" id="strength-indicator"></div>
    </div>

    <div class="form-group">
      <label for="password">New Password</label>
      <input 
        type="password" 
        id="password" 
        name="password" 
        placeholder="Enter new password"
        oninput="validatePasswordRequirements(this.value)"
        required
      />
    </div>

    <div class="form-group">
      <label for="confirm">Confirm Password</label>
      <input 
        type="password" 
        id="confirm" 
        name="confirm" 
        placeholder="Confirm password"
        oninput="validatePasswordRequirements(document.getElementById('password').value)"
        required
      />
    </div>

    <button type="submit" class="btn" id="submit-btn" disabled style="opacity: 0.6; cursor: not-allowed;">Reset Password</button>
  </form>

  <div class="back-link">
    <a href="{{ url_for('login') }}">Back to Login</a>
  </div>
</div>

<script>
function validatePasswordRequirements(password) {
  const lengthReq = document.getElementById('length-req');
  const uppercaseReq = document.getElementById('uppercase-req');
  const numberReq = document.getElementById('number-req');
  const specialReq = document.getElementById('special-req');
  const submitBtn = document.getElementById('submit-btn');
  const strengthIndicator = document.getElementById('strength-indicator');
  const passwordInput = document.getElementById('password');
  const confirmInput = document.getElementById('confirm');

  // Check each requirement
  const hasLength = password.length >= 8;
  const hasUppercase = /[A-Z]/.test(password);
  const hasNumber = /[0-9]/.test(password);
  const hasSpecial = /[!@#$%^&*]/.test(password);
  const passwordsMatch = password === confirmInput.value;

  // Update requirement indicators
  lengthReq.classList.toggle('met', hasLength);
  uppercaseReq.classList.toggle('met', hasUppercase);
  numberReq.classList.toggle('met', hasNumber);
  specialReq.classList.toggle('met', hasSpecial);

  // Calculate strength
  const metCount = [hasLength, hasUppercase, hasNumber, hasSpecial].filter(Boolean).length;
  
  // Update strength indicator
  if (metCount === 0) {
    strengthIndicator.classList.remove('weak', 'medium', 'strong');
    strengthIndicator.textContent = '';
  } else if (metCount < 3) {
    strengthIndicator.classList.remove('medium', 'strong');
    strengthIndicator.classList.add('weak');
    strengthIndicator.textContent = '⚠️ Weak password';
  } else if (metCount === 3) {
    strengthIndicator.classList.remove('weak', 'strong');
    strengthIndicator.classList.add('medium');
    strengthIndicator.textContent = '✓ Medium strength';
  } else {
    strengthIndicator.classList.remove('weak', 'medium');
    strengthIndicator.classList.add('strong');
    strengthIndicator.textContent = '✓ Strong password';
  }

  // Enable submit button only if all requirements met AND passwords match
  const allMet = hasLength && hasUppercase && hasNumber && hasSpecial && passwordsMatch;
  submitBtn.disabled = !allMet;
  submitBtn.style.opacity = allMet ? '1' : '0.6';
  submitBtn.style.cursor = allMet ? 'pointer' : 'not-allowed';
}

function validatePasswordReset() {
  const password = document.getElementById('password').value;
  const confirm = document.getElementById('confirm').value;

  if (password !== confirm) {
    alert('Passwords do not match!');
    return false;
  }

  // Double check all requirements
  const hasLength = password.length >= 8;
  const hasUppercase = /[A-Z]/.test(password);
  const hasNumber = /[0-9]/.test(password);
  const hasSpecial = /[!@#$%^&*]/.test(password);

  if (!hasLength || !hasUppercase || !hasNumber || !hasSpecial) {
    alert('Password does not meet all requirements!');
    return false;
  }

  return true;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
  const passwordInput = document.getElementById('password');
  const confirmInput = document.getElementById('confirm');
  
  if (passwordInput && confirmInput) {
    // Add visual indicator to confirm field when passwords match
    confirmInput.addEventListener('input', function() {
      const password = passwordInput.value;
      if (this.value && this.value === password) {
        this.style.borderColor = '#10b981';
        this.style.backgroundColor = '#f0fdf4';
      } else if (this.value) {
        this.style.borderColor = '#ef4444';
        this.style.backgroundColor = '#fef2f2';
      } else {
        this.style.borderColor = '#e5e7eb';
        this.style.backgroundColor = 'white';
      }
      validatePasswordRequirements(password);
    });

    // Initialize on load if fields have values
    if (passwordInput.value) {
      validatePasswordRequirements(passwordInput.value);
    }
  }
});
</script>
{% endblock %}

{% extends "base.html" %}
{% block title %}My Profile{% endblock %}
{% block content %}

<section class="hero" style="background: linear-gradient(135deg, #2563EB 0%, #1e40af 100%); position: relative; overflow: hidden;">
  <div style="position: absolute; top: -20%; left: -10%; opacity: 0.1; font-size: 280px;">â­</div>
  <div style="position: relative; z-index: 1;">
    <h1 class="page-title" style="color: white;">My Profile</h1>
    <p class="page-subtitle" style="color: rgba(255,255,255,0.95);">Your Hidden Gems account and activity</p>
  </div>
</section>

<div style="max-width: 1200px; margin: 0 auto; padding: 2rem 1rem;">
  
  <!-- Profile Header Card -->
  <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 2.5rem; display: grid; grid-template-columns: auto 1fr auto; gap: 2rem; align-items: start;">
    
    <!-- Avatar & Basic Info -->
    <div style="text-align: center;">
      <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #2563EB 0%, #dbeafe 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; font-weight: bold; margin-bottom: 1rem;">
        {{ session.get('username', 'U')[0].upper() }}
      </div>
      <p style="margin: 0; font-size: 0.9rem; color: #666;">
        <a href="{{ url_for('settings') }}" style="color: #2563EB; text-decoration: none; font-weight: 600;">ğŸ“¸ Change Avatar</a>
      </p>
    </div>

    <!-- Account Info -->
    <div>
      <h2 style="margin: 0 0 1rem 0; font-size: 1.5rem; color: #2c3e50;">{{ session.get('username', 'User') }}</h2>
      <p style="margin: 0 0 0.75rem 0; color: #666;">ğŸ“§ {{ session.get('email') }}</p>
      <p style="margin: 0 0 0.75rem 0; color: #666; font-size: 0.95rem;">ğŸ—“ï¸ Member since: {{ member_since or 'Recently' }}</p>
      <p style="margin: 0; color: #666; font-size: 0.95rem;">â° Last login: {{ last_login or 'Today' }}</p>
    </div>

    <!-- Quick Stats -->
    <div style="text-align: right;">
      <div style="margin-bottom: 1.5rem;">
        <div style="font-size: 2rem; font-weight: bold; color: #2563EB;">{{ review_count }}</div>
        <div style="color: #666; font-size: 0.9rem;">Reviews</div>
      </div>
      <div style="margin-bottom: 1.5rem;">
        <div style="font-size: 2rem; font-weight: bold; color: #2563EB;">{{ fav_count }}</div>
        <div style="color: #666; font-size: 0.9rem;">Favorites</div>
      </div>
      <div>
        <div style="font-size: 2rem; font-weight: bold; color: #2563EB;">{{ avg_rating or '4.8' }}â­</div>
        <div style="color: #666; font-size: 0.9rem;">Avg Rating</div>
      </div>
    </div>

  </div>

  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
    
    <!-- Quick Actions -->
    <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
      <h3 style="margin: 0 0 1.5rem 0; color: #2c3e50; font-size: 1.1rem;">Quick Actions</h3>
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        <a href="{{ url_for('settings') }}" style="padding: 1rem; background: linear-gradient(135deg, #2563EB 0%, #1e40af 100%); color: white; border: none; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 600; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
          âš™ï¸ Account Settings
        </a>
        <a href="{{ url_for('favorites') }}" style="padding: 1rem; background: white; color: #2563EB; border: 2px solid #2563EB; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 600; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.backgroundColor='#dbeafe'" onmouseout="this.style.backgroundColor='white'">
          â¤ï¸ View Favorites
        </a>
        <a href="{{ url_for('logout') }}" style="padding: 1rem; background: white; color: #999; border: 2px solid #ddd; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 600; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.color='#666'" onmouseout="this.style.color='#999'">
          ğŸšª Logout
        </a>
      </div>
    </div>

    <!-- Account Stats -->
    <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
      <h3 style="margin: 0 0 1.5rem 0; color: #2c3e50; font-size: 1.1rem;">Activity Summary</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
        <div style="padding: 1rem; background: #eff6ff; border-radius: 8px; border-left: 4px solid #2563EB; text-align: center;">
          <div style="font-size: 1.5rem; font-weight: bold; color: #2563EB;">{{ review_count }}</div>
          <div style="font-size: 0.9rem; color: #666;">Total Reviews</div>
        </div>
        <div style="padding: 1rem; background: #eff6ff; border-radius: 8px; border-left: 4px solid #2563EB; text-align: center;">
          <div style="font-size: 1.5rem; font-weight: bold; color: #2563EB;">{{ fav_count }}</div>
          <div style="font-size: 0.9rem; color: #666;">Saved Businesses</div>
        </div>
        <div style="padding: 1rem; background: #eff6ff; border-radius: 8px; border-left: 4px solid #2563EB; text-align: center;">
          <div style="font-size: 1.5rem; font-weight: bold; color: #2563EB;">{{ avg_rating or '4.8' }}â­</div>
          <div style="font-size: 0.9rem; color: #666;">Avg Rating Given</div>
        </div>
        <div style="padding: 1rem; background: #eff6ff; border-radius: 8px; border-left: 4px solid #2563EB; text-align: center;">
          <div style="font-size: 1.5rem; font-weight: bold; color: #2563EB;">{{ deals_used or 0 }}</div>
          <div style="font-size: 0.9rem; color: #666;">Deals Used</div>
        </div>
      </div>
    </div>

  </div>

  <!-- My Reviews Section -->
  <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 3rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f0f0f0;">
      <h2 style="margin: 0; color: #2c3e50; font-size: 1.3rem;">ğŸ“ My Reviews ({{ review_count }})</h2>
      <a href="#" style="color: #2563EB; font-weight: 600; text-decoration: none;">View All â†’</a>
    </div>
    
    {% if reviews %}
      <div style="display: grid; gap: 1.5rem;">
        {% for review in reviews[:5] %}
        <div style="padding: 1.5rem; background: #fafafe; border-radius: 8px; border-left: 4px solid #2563EB;">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
            <div>
              <h4 style="margin: 0 0 0.25rem 0; color: #2c3e50; font-size: 1.05rem;">{{ review.business_name }}</h4>
              <p style="margin: 0; color: #999; font-size: 0.9rem;">{{ review.created_date }}</p>
            </div>
            <div style="display: flex; gap: 0.5rem;">
              <button onclick="editReview({{ review.id }})" style="padding: 0.5rem 1rem; background: white; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 0.9rem; color: #666; transition: all 0.3s;" onmouseover="this.style.backgroundColor='#fafafe'" onmouseout="this.style.backgroundColor='white'">
                âœï¸ Edit
              </button>
              <button onclick="deleteReview({{ review.id }})" style="padding: 0.5rem 1rem; background: white; border: 1px solid #fee; border-radius: 6px; cursor: pointer; font-size: 0.9rem; color: #d32f2f; transition: all 0.3s;" onmouseover="this.style.backgroundColor='#ffebee'" onmouseout="this.style.backgroundColor='white'">
                ğŸ—‘ï¸ Delete
              </button>
            </div>
          </div>
          <div style="margin-bottom: 0.75rem; color: #2563EB; font-weight: 600;">
            {% for i in range(review.rating) %}â­{% endfor %}{{ review.rating }} / 5
          </div>
          <p style="margin: 0; color: #666; line-height: 1.6;">{{ review.review_text }}</p>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color: #999; text-align: center; padding: 2rem;">No reviews yet. <a href="{{ url_for('directory') }}" style="color: #2563EB; text-decoration: none;">Write your first review â†’</a></p>
    {% endif %}
  </div>

  <!-- My Favorites Section -->
  <div style="background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 2px solid #f0f0f0;">
      <h2 style="margin: 0; color: #2c3e50; font-size: 1.3rem;">â¤ï¸ My Favorites ({{ fav_count }})</h2>
      <a href="{{ url_for('favorites') }}" style="color: #2563EB; font-weight: 600; text-decoration: none;">View All â†’</a>
    </div>
    
    {% if favorites %}
      <div class="grid" style="margin-bottom: 0;">
        {% for fav in favorites[:4] %}
        <div class="business-card" style="border: 2px solid #dbeafe;">
          <div class="business-card-image" style="height: 150px; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); display: flex; align-items: center; justify-content: center; font-size: 3rem;">
            â¤ï¸
          </div>
          <div class="business-card-content" style="padding: 1rem;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 1rem;">{{ fav.name }}</h3>
            <p style="margin: 0 0 0.75rem 0; font-size: 0.9rem; color: #666;">{{ fav.category }}</p>
            <a href="{{ url_for('business_detail', business_id=fav.id) }}" style="padding: 0.6rem 1rem; background: #2563EB; color: white; border: none; border-radius: 6px; text-decoration: none; font-weight: 600; font-size: 0.9rem;">
              View Details
            </a>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color: #999; text-align: center; padding: 2rem;">No favorites yet. <a href="{{ url_for('directory') }}" style="color: #2563EB; text-decoration: none;">Save your favorites â†’</a></p>
    {% endif %}
  </div>

</div>

<script>
function editReview(reviewId) {
  alert('Edit review feature coming soon!');
}

function deleteReview(reviewId) {
  if (confirm('Delete this review? This cannot be undone.')) {
    // TODO: Implement delete review API call
    alert('Review deleted!');
  }
}
</script>

<!-- Help Button -->
<button class="help-btn" onclick="Help.toggle()" aria-label="Open help menu">â“ Help</button>

{% endblock %}
